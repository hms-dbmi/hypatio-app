<!DOCTYPE html>

{% load static %}
{% load projects_extras %}

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="shortcut icon" href="{% static 'favicon.ico' %}" type="image/vnd.microsoft.icon"/>
        <meta name="google-site-verification" content="OdYYzhkJpqgioUekvMbDvbyW6spxovdO_jmqVkiKVDE" />

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-70908320-25"></script>
        <script nonce="{{ request.csp_nonce }}">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-70908320-25');
        </script>

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

        <!-- Text Font -->
        <link href="https://fonts.googleapis.com/css?family=Libre+Franklin:300,400,500,600,700&amp;subset=latin-ext" rel="stylesheet">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-Bx4pytHkyTDy3aJKjGkGoHPt3tvv6zlwwjc3iqN7ktaiEMLDPqLSZYts2OjKcBx1" crossorigin="anonymous">

        <!-- Bootstrap notify -->
        <link rel="stylesheet" href="{% static 'plugins/bootstrap-notify/bootstrap-notify.css' %}">

        <!-- HTMX -->
        <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js" integrity="sha384-Akqfrbj/HpNVo8k11SXBb6TlBWmXXlYQrCSqEWmyKJe+hDm3Z/B2WVG4smwBkRVm" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="{% static 'css/htmx.css' %}">
        <script src="https://unpkg.com/htmx-ext-path-deps@2.0.0/path-deps.js"></script>
        <script nonce="{{request.csp_nonce}}">
          htmx.config.includeIndicatorStyles = false;
          htmx.config.inlineScriptNonce = "{{ request.csp_nonce }}";
          htmx.config.inlineStyleNonce = "{{ request.csp_nonce }}";
          window.VIDEOJS_NO_DYNAMIC_STYLE = true;
        </script>

        <!-- DBMI Portal Styles -->
        <link rel="stylesheet" href="{% static 'css/portal.css' %}">
        <link rel="stylesheet" href="{% static 'animate.css' %}" />
        <link rel="stylesheet" href="{% static 'custom.css' %}" />

        <!-- DBMI Portal Javascript -->
        <script src="{% static 'js/portal.js' %}"></script>

        <title>{% block tab_name %}DBMI Portal{% endblock %}</title>

        {% block headscripts %}
        {% endblock %}
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top navbar-custom" role="navigation" id="topnavbar">
            <div class="container">
                <div class="navbar-header"><a href="/" class="navbar-brand">DBMI Data Portal</a>
                    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
                </div>

                <div class="navbar-collapse collapse" id="navbar-main">
                    <ul class="nav navbar-nav">

                        {% url 'index' as index_url %}
                        <li class="nav-item{% if request.path == index_url %} active{% endif %}"><a class="nav-link" href="{{ index_url }}">Home</a></li>

                        {% for group in navigation.parent_groups %}
                        {% url 'group' group.key as group_url %}
                        <li class="dropdown">
                          <a class="dropdown-toggle" data-toggle="dropdown" href="#">{{ group.navigation_title|default:group.title }} <span class="caret"></span></a>
                          <ul class="dropdown-menu" aria-labelledby="{{ group.navigation_title|default:group.title }}">
                            {% for child in group.active_project_child_groups %}
                            {% url 'group' child.key as group_url %}
                            <li class="nav-item{% if request.path == group_url or child.key == navigation.active_group.key %} active{% endif %}"><a class="nav-link" href="{{ group_url }}">{{ child.navigation_title|default:child.title }}</a></li>
                            {% endfor %}
                          </ul>
                        </li>
                        {% endfor %}

                        {% for group in navigation.groups %}
                        {% url 'group' group.key as group_url %}
                        <li class="nav-item{% if request.path == group_url or group.key == navigation.active_group.key %} active{% endif %}">
                          <a class="nav-link" href="{% if group.group_url %}{{ group.group_url }}{% else %}{{ group_url }}{% endif %}">{{ group.navigation_title|default:group.title }}</a>
                        </li>
                        {% endfor %}

                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="download">Contact <span class="caret"></span></a>
                            <ul class="dropdown-menu" aria-labelledby="download">
                                <li><a class="nav-link" href="https://n2c2.dbmi.hms.harvard.edu/" target="_blank">n2c2 website <span class="fas fa-sm fa-external-link"></span></a></li>
                                <li><a class="nav-link" href="https://dbmi.hms.harvard.edu/" target="_blank">DBMI website <span class="fas fa-sm fa-external-link"></span></a></li>
                                <li>
                                  <a href=# class="contact-form-link" data-toggle="modal" data-target="#contact-form-modal"
                                    hx-trigger="click" hx-target="#contact-form-modal"
                                    hx-get="{% url 'contact:contact_form' %}">
                                    Email us <span class="fas fa-sm fa-envelope"></span>
                                  </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        {% if request.user.is_authenticated %}
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="download">{{ request.user.email }}<span class="caret"></span></a>
                                <ul class="dropdown-menu" aria-labelledby="downloadn">
                                    <li><a class="nav-link" href="{% url 'profile:profile' %}">Profile <span class="fas fa-sm fa-user"></span></a></li>
                                    {% is_project_manager request as is_manager %}
                                    {% if is_manager %}
                                    <li><a class="nav-link" href="{% url 'manage:manage-projects' %}">Manage Projects</a></li>
                                    {% endif %}
                                    {% if dbmiuser and dbmiuser.jwt %}
                                    <li><a id="jwt-copy" class="nav-link clipboard-copy" data-clipboard-text="{{ dbmiuser.jwt|default:"<empty>" }}" data-toggle="tooltip" title="Copy API Key" data-tooltip-title="Copy API Key">API Key <i class="fa fa-wrench" aria-hidden="true"></i>
                                    {% endif %}
                                    </a></li>
                                    <li><a class="nav-link" href="{% url 'profile:signout' %}">Sign Out</a></li>
                                </ul>
                            </li>
                        {% else %}
                            <li><a href="{{ request.build_absolute_uri|get_login_url }}"><span class="fas fa-sm fa-user"></span> <strong>Login / Register</strong></a></li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>

        {% block content %}
        {% endblock %}

        {# Add a placeholder for the modal contact form #}
        <div id='contact-form-modal' class='modal fade' tabindex='-1'></div>

        {% block footerscripts %}
        {% endblock %}
    </body>

    <!-- Clipboard.js -->
    <script src="{% static 'js/clipboard.min.js' %}"></script>

    <!-- Popper.js -->
    <script src="{% static 'js/popper.min.js' %}"></script>

    <!-- Bootstrap.notify.js -->
    <script src="{% static 'plugins/bootstrap-notify/bootstrap-notify.min.js' %}"></script>

    {# Allow for some javascript to be added per page #}
    {% block javascript %}{% endblock %}
</html>
