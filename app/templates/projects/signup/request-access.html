{% load static %}

{% if panel.additional_context.requested_access %}
    Your request is being reviewed. Please use the 'Contact Us' link for any further questions.
{% else %}
    <form name="access_request_form" method="post" enctype="multipart/form-data"
          ic-post-to="{% url 'projects:submit_user_permission_request' %}"
          ic-on-success="onAccessRequestSuccess()"
          ic-on-error="onAccessRequestError()">
        <fieldset>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <input type="hidden" id="project_key" name="project_key" value="{{ project.project_key }}" />
                        Please click the button below to confirm your request to access this dataset. An administrator will review any agreement forms you have signed and may follow up with you for additional information. Your request will typically be reviewed within five business days.
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <button id="request-access-submit-button" type="submit" class="btn btn-primary">Request Access
                            <span id="request-access-indicator" style="display: none; margin-left: 5px;" class="ic-indicator fa fa-spinner fa-spin"></span>
                        </button>
                    </div>
                </div>
            </div>
        </fieldset>
        {% csrf_token %}
    </form>
{% endif %}

<script type="application/javascript">

  function onAccessRequestSuccess() {

    // Update button
    $('#request-access-submit-button').html('Request submitted!&nbsp;&nbsp;<i class=\'fa fa-check\'></i>').prop('disabled', true).toggleClass('btn-primary btn-success')

    // Notify
    notify('success', 'Access request submitted', 'thumbs-up');

    // Update panel class
    $(".container").find(".current-step-header").toggleClass("current-step-header completed-step-header");
  }

  function onAccessRequestError() {

    // Notify
    notify('danger', 'Access request failed, please contact support or try again', 'exclamation-sign');
  }
</script>
